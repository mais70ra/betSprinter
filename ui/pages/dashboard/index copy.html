<!doctype html>
<html>

<head>
  <meta charset="utf-8">
  <title>Bet sprinter</title>
</head>
<link rel="stylesheet" type="text/css" href="../../static/css/main.css">
<link href='//fonts.googleapis.com/css?family=Signika+Negative:300,400' rel='stylesheet' type='text/css'>
<style>
  * {
    padding: 0;
    margin: 0
  }
</style>
<script src="../../node_modules/pixi.js/dist/pixi.min.js"></script>
<script src="../../node_modules/gsap/dist/gsap.min.js"></script>
<script src="../../libs/popup.js"></script>
<script src="../../libs/utils.js"></script>
<script src="../../libs/websocket.js"></script>
<script src="/pages/dashboard/index.js"></script>

<body>
  <div class="bar">
    <link rel="shortcut icon" href="favicon.ico" type="/static/images/logout-32.png" />
    <img src="/static/images/logout.png" alt="Logout" class="logoutImage pointer right" onclick="logout()">
  </div>
  <div class="b"></div>
  <div class="clear p5"></div>
  <div class="bet-container">
    <div class="clear p5"></div>
    <div class="bet-line-animation">
      <div class="clear p5"></div>
      <div class="text-center"><span id="line-duration-status-text">The game will start in: </span><span
          id="line-duration-number"></span></div>
      <div class="clear p5"></div>
      <div id="line-animation"></div>
      <div id="line-path"></div>
      <div class="clear p5"></div>
      <div class="nav">
        <button id="play" onclick="tween.play()">play()</button>
        <button id="restart" onclick="tween.restart()">restart()</button>
      </div>
      <div class="clear p5"></div>
      <div class="bet-container-player">
        <label id="choosePlayer">Choose player</label>
        <div class="clear p5"></div>
        <button class="btn-player btn btn-blue" onclick="betOnPlayer(this, 1);">One</button>
        <button class="btn-player btn btn-blue" onclick="betOnPlayer(this, 2);">Two</button>
        <button class="btn-player btn btn-blue" onclick="betOnPlayer(this, 3);">Three</button>
        <button class="btn-player btn btn-blue" onclick="betOnPlayer(this, 4);">Four</button>
        <button class="btn-player btn btn-blue" onclick="betOnPlayer(this, 5);">Five</button>
        <button class="btn-player btn btn-blue" onclick="betOnPlayer(this, 6);">Six</button>
        <button class="btn-player btn btn-blue" onclick="betOnPlayer(this, 7);">Seven</button>
        <button class="btn-player btn btn-blue" onclick="betOnPlayer(this, 8);">Eight</button>
      </div>
      <div class="clear p5"></div>
      <div class="bet-container-amount">
        <label id="chooseAmount">Choose amount</label>
        <div class="clear p5"></div>
        <button class="btn-amount btn btn-blue" onclick="betAmount(this, 1);">1</button>
        <button class="btn-amount btn btn-blue" onclick="betAmount(this, 5);">5</button>
        <button class="btn-amount btn btn-blue" onclick="betAmount(this, 10);">10</button>
        <button class="btn-amount btn btn-blue" onclick="betAmount(this, 20);">20</button>
      </div>
      <div class="clear p5"></div>
      <div class="bet-container-finish">
        <div class="clear p5"></div>
        <button class="btn btn-green" onclick="finishBet(this);">Finish bet</button>
        <div class="clear p5"></div>
      </div>
    </div>
    <div id="game-container"></div>
</body>
<script>
  var renderer = PIXI.autoDetectRenderer(800, 400, { antialias: true });
  document.getElementById('game-container').appendChild(renderer.view);
  var stage = new PIXI.Container();
  // let roundBox = new PIXI.Graphics();
  // var stage = new PIXI.Container();
  // stage.interactive = true;
  // roundBox.lineStyle(4, 0x99CCFF, 1);
  // roundBox.beginFill(0xFF9933);
  // x = x + 1/2;
  // y = y + 1/2;
  // roundBox.drawRoundedRect(0, 0, 300, 100, 50);
  // roundBox.endFill();
  // roundBox.x = 48;
  // roundBox.y = 190;
  // stage.addChild(roundBox);
  // renderer.render(stage);
  // // return;
  
  var graphics = new PIXI.Graphics();
  var colors = {
    c0: '0xFF8C00',
    c1: '0x3009CB',
    c2: '0xCB2909',
    c3: '0x07A7EC',
    c4: '0x16E138',
    c5: '0xF510CF',
    c6: '0xFDFD03',
    c7: '0x8A262A'
  };
  let numberOfPlayers = 8;
  for (var i = 0; i < numberOfPlayers; i++) {
    if (i === 0) {
      graphics.beginFill(0x008000, 1);
    }
    graphics.lineStyle(10, colors['c' + i], 0.8);
    graphics.moveTo(200, 100 - (i * 10));
    graphics.quadraticCurveTo(0 - (i * 20), 200, 200, 300 + (i * 10));
    graphics.lineTo(600, 300 + (i * 10));
    graphics.quadraticCurveTo(800 + (i * 20), 200, 600, 100 - (i * 10));
    graphics.lineTo(200, 100 - (i * 10));
    graphics.endFill();
  }
  stage.addChild(graphics);
  var players = [];
  for (var i = 0; i < numberOfPlayers; i++) {
    players[i] = new PIXI.Graphics();
    stage.addChild(players[i]);
    players[i].countPosition = 0;
    // players[i].speed = 1 + i * 0.1; // which place
    players[i].position.x = 100;
    players[i].position.y = 200 + i*10;
    players[i].drawCircle(100, -100 - 2 * i*10, 5);
  }

  function startTheGame(winners, duration) {
    let length = players.length;
    for (var i = 0; i < length; i++) {
      players[i].countPosition = 0;
      players[i].speed = 2/3 + winners[i] / 100;
      players[i].winnerPosition = winners[i];
    }
    animate();
  }
  // 6*5
  renderer.render(stage);
  function animate() {
    for (var i = 0; i < numberOfPlayers; i++) {
      var stopAnimation = playerAnimation(players[i], i * 10);
    }
    renderer.render(stage);
    if (!stopAnimation) {
      requestAnimationFrame(animate);
    }
  }

  function playerAnimation(pl, len) {
    pl.clear();
    pl.beginFill(0xFFFFFF, 1);
    if (pl.countPosition < 400) {
      pl.countPosition += pl.speed;
      pl.drawCircle(100 + pl.countPosition, -100 - 2 * len, 5);
    } else if (pl.countPosition > 399 && pl.countPosition < 599) {
      pl.countPosition += pl.speed;
      x = getPt(500, 500, pl.countPosition - 400);
      y = getPt(-100, 0, pl.countPosition - 400);
      pl.drawCircle(x + len, y, 5);
    } else if (pl.countPosition < 999) {
      pl.countPosition += pl.speed;
      pl.drawCircle(500 + (601 - pl.countPosition), 100, 5);
    } else if (pl.countPosition < 1199) {
      pl.countPosition += pl.speed;
      x = getPt(100, 100, pl.countPosition - 999);
      y = getPt(100, 0, pl.countPosition - 999);
      pl.drawCircle(x - len, y, 5);
    } else {
      pl.drawCircle(100, - 100 - 2 * len, 5);
      if (pl.winnerPosition === 1) {
        return true;
      }
    }
    return false;
  }

  function getPt(n1, n2, perc) {
    let diff = n2 - n1;
    return n1 + (diff * perc/100);
  }

</script>

</html>